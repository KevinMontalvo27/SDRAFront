<div class="container mx-auto p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Gesti√≥n de Contenidos</h1>
    <button class="btn btn-primary" (click)="openCreateUnit()">
      + Nueva Unidad
    </button>
  </div>

  <div *ngIf="isLoading" class="flex justify-center py-12">
    <span class="loading loading-spinner loading-lg"></span>
  </div>

  <div *ngIf="!units$" class="text-center py-12">
    <p class="text-lg mb-4">No hay unidades creadas</p>
    <button class="btn btn-primary" (click)="openCreateUnit()">
      Crear Primera Unidad
    </button>
  </div>

  <!-- Lista de Unidades -->
  <!-- <ng-container *ngIf="units$ | async as units"> -->
    <div data-theme="dark" *ngIf="units$ | async as units">
      <div
        *ngFor="let unit of units"
        class="collapse collapse-arrow bg-base-200 mb-4"
      >
        <input type="checkbox" />
        <div class="collapse-title text-xl font-medium flex justify-between">
          <span>{{ unit.numero_unidad }}. {{ unit.nombre }}</span>
          <div class="flex gap-2" (click)="$event.stopPropagation()">
            <button
              class="btn btn-sm btn-ghost"
              (click)="openCreateTopic(unit.id!)"
              title="Agregar tema"
            >
              +
            </button>
            <button class="btn btn-sm btn-ghost" (click)="openEditUnit(unit)">
              ‚úèÔ∏è
            </button>
            <button
              class="btn btn-sm btn-ghost text-error"
              (click)="deleteUnit(unit.id!)"
            >
              üóëÔ∏è
            </button>
          </div>
        </div>
        <div class="collapse-content">
          <p class="mb-4">{{ unit.descripcion }}</p>

          <!-- Temas -->
          <div *ngFor="let topic of unit.temas" class="card bg-base-100 mb-3">
            <div class="card-body p-4">
              <div class="flex justify-between">
                <h3 class="font-semibold">
                  {{ topic.numero_tema }}. {{ topic.nombre }}
                </h3>
                <div class="flex gap-2">
                  <button
                    class="btn btn-xs"
                    (click)="openCreateObject(topic.id!.toString())"
                  >
                    + Objeto
                  </button>
                  <button class="btn btn-xs" (click)="openEditTopic(topic)">
                    ‚úèÔ∏è
                  </button>
                  <button
                    class="btn btn-xs text-error"
                    (click)="deleteTopic(topic.id!.toString())"
                  >
                    üóëÔ∏è
                  </button>
                </div>
              </div>
              <p class="text-sm">{{ topic.descripcion }}</p>

              <!-- Objetos de Aprendizaje -->
              <div
                *ngIf="learningObjects$ | async as learningObjects"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mt-3"
              >
                <div
                  *ngFor="let obj of learningObjects"
                  class="card bg-base-200 shadow-sm"
                >
                  <div class="card-body p-3">
                    <div class="flex items-start gap-2">
                      <span class="text-2xl">
                        {{
                          obj.type === "document"
                            ? "üìÑ"
                            : obj.type === "video"
                            ? "üé•"
                            : obj.type === "image"
                            ? "üñºÔ∏è"
                            : obj.type === "external"
                            ? "üéµ"
                            : "üìù"
                        }}
                      </span>
                      <div class="flex-1 min-w-0">
                        <h4 class="font-semibold text-sm truncate">
                          {{ obj.title }}
                        </h4>
                        <p class="text-xs opacity-70">{{ obj.type }}</p>
                      </div>
                      <div class="dropdown dropdown-end">
                        <label tabindex="0" class="btn btn-ghost btn-xs"
                          >‚ãÆ</label
                        >
                        <ul
                          tabindex="0"
                          class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-32"
                        >
                          <li><a (click)="openEditObject(obj)">Editar</a></li>
                          <li>
                            <a
                              class="text-error"
                              (click)="deleteObject(obj.id!)"
                              >Eliminar</a
                            >
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            *ngIf="!unit.temas.length"
            class="text-center py-4 text-sm opacity-60"
          >
            No hay temas.
            <a class="link" (click)="openCreateTopic(unit.id!)">Agregar tema</a>
          </div>
        </div>
      </div>
    </div>
  <!-- </ng-container> -->
</div>

<!-- Modal Unidad -->
 <!-- *ngIf="showUnitModal && editingUnit" -->
<!-- <div  class="modal modal-open">
  <div class="modal-box">
    <h3 class="font-bold text-lg mb-4">Editar Unidad</h3>
    <form #unitForm="ngForm" (ngSubmit)="saveUnit(unitForm.value)">
      <div class="form-control">
        <label class="label"><span class="label-text">T√≠tulo</span></label>
        <input
          type="text"
          name="nombre"
          [(ngModel)]="editingUnit!.nombre"
          class="input input-bordered"
          required
        />
      </div>
      <div class="form-control mt-3">
        <label class="label"><span class="label-text">Descripci√≥n</span></label>
        <textarea
          name="descripcion"
          [(ngModel)]="editingUnit!.descripcion"
          class="textarea textarea-bordered"
          required
        ></textarea>
      </div>
      <div class="form-control mt-3">
        <label class="label"><span class="label-text">Orden</span></label>
        <input
          type="number"
          name="numero_unidad"
          [(ngModel)]="editingUnit!.numero_unidad"
          class="input input-bordered"
          min="1"
          required
        />
      </div>
      <div class="modal-action">
        <button type="button" class="btn" (click)="showUnitModal = false">
          Cancelar
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!unitForm.valid"
        >
          Guardar
        </button>
      </div>
    </form>
  </div>
</div> -->

<!-- *ngIf="showUnitModal && !editingUnit" -->
<!-- <div  class="modal modal-open">
  <div class="modal-box">
    <h3 class="font-bold text-lg mb-4">Nueva Unidad</h3>
    <form #unitForm="ngForm" (ngSubmit)="saveUnit(unitForm.value)">
      <div class="form-control">
        <label class="label"><span class="label-text">T√≠tulo</span></label>
        <input
          type="text"
          name="nombre"
          [(ngModel)]="nombreNuevaUnidad"
          class="input input-bordered"
          required
        />
      </div>
      <div class="form-control mt-3">
        <label class="label"><span class="label-text">Descripci√≥n</span></label>
        <textarea
          name="descripcion"
          [(ngModel)]="descripcionNuevaUnidad"
          class="textarea textarea-bordered"
          required
        ></textarea>
      </div>
      <div class="form-control mt-3">
        <label class="label"><span class="label-text">Orden</span></label>
        <input
          type="number"
          name="numero_unidad"
          [(ngModel)]="numeroNuevaUnidad"
          class="input input-bordered"
          min="1"
          required
        />
      </div>
      <div class="modal-action">
        <button type="button" class="btn" (click)="showUnitModal = false">
          Cancelar
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!unitForm.valid"
        >
          Guardar
        </button>
      </div>
    </form>
  </div>
</div> -->

<!-- Modal Tema (similar estructura) -->
 <!-- *ngIf="showTopicModal" -->
<div  data-theme="light" class="modal modal-open">
  <div class="modal-box">
    <h3 class="font-bold text-lg mb-4">
      {{ editingTopic ? "Editar" : "Nuevo" }} Tema
    </h3>
    <form #topicForm="ngForm" (ngSubmit)="saveTopic(topicForm.value)">
      <div class="form-control">
        <label class="label"><span class="label-text">T√≠tulo</span></label>
        <input
          type="text"
          name="nombre"
          [ngModel]="editingTopic?.nombre"
          class="input input-bordered"
          required
        />
      </div>
      <div class="form-control mt-3">
        <label class="label"><span class="label-text">Descripci√≥n</span></label>
        <textarea
          name="description"
          [ngModel]="editingTopic?.descripcion"
          class="textarea textarea-bordered"
          required
        ></textarea>
      </div>
      <div class="form-control mt-3">
        <label class="label"><span class="label-text">Orden</span></label>
        <input
          type="number"
          name="order"
          [ngModel]="editingTopic?.numero_tema"
          class="input input-bordered"
          min="1"
          required
        />
      </div>
      <div class="modal-action">
        <button type="button" class="btn" (click)="showTopicModal = false">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Objeto de Aprendizaje -->
 <!-- *ngIf="showObjectModal" -->
<!-- <div  data-theme="light" class="modal modal-open">
  <div class="modal-box max-w-2xl">
    <h3 class="font-bold text-lg mb-4">
      {{ editingObject ? "Editar" : "Nuevo" }} Objeto
    </h3>
    <form #objForm="ngForm" (ngSubmit)="saveObject(objForm.value)">
      <input type="hidden" name="id_tema" [value]="1" ngModel />

      <div class="form-control">
        <label class="label"><span class="label-text">T√≠tulo</span></label>
        <input
          type="text"
          name="nombre"
          [(ngModel)]="nombre"
          class="input input-bordered"
          required
        />
      </div>

      <div class="form-control mt-3">
        <label class="label"><span class="label-text">Descripci√≥n</span></label>
        <textarea
          name="descripcion"
          [(ngModel)]="descripcion"
          class="textarea textarea-bordered"
          required
        ></textarea>
      </div>

      <div class="form-control mt-3">
        <label class="label"><span class="label-text">Tipo</span></label>
        <select
          name="id_type"
          class="select select-bordered"
          required
          #typeSelect
          [(ngModel)]="id_type"
        >
          <option value="1">Texto Plano</option>
          <option value="2">PDF</option>
          <option value="3">Video</option>
          <option value="4">Imagen</option>
          <option value="5">Audio</option>
        </select>
      </div>

      <div *ngIf="typeSelect.value !== '1'" class="form-control mt-3">
        <label class="label"><span class="label-text">Archivo</span></label>
        <input
          type="file"
          name="file"
          class="file-input file-input-bordered"
          #fileInput
          (change)="file = fileInput.files ? fileInput.files[0] : null"
        />
      </div>
      <div class="modal-action">
        <button type="button" class="btn" (click)="showObjectModal = false">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </div>
    </form>
  </div>
</div> -->
